<!DOCTYPE html>
<!-- saved from url=(0068)https://gist.github.com/1929927#file_11500811g_5323_assign1.markdown -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>WebDB Assignment 1 — Gist</title>
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="shortcut icon" href="https://github.com/favicon.ico" type="image/x-icon">

    <meta content="authenticity_token" name="csrf-param">
<meta content="sfsib+2mogDgc4KIjEu6jbnJtggUW13qTOO65gv+RdU=" name="csrf-token">

    <link href="./11500811g_files/gist-7d958a633774c788fa81121de03cec1cf67fb774.css" media="screen" rel="stylesheet" type="text/css">

    <script src="./11500811g_files/jquery-5b140862bd914d3619171dece9be92269c2b1fe1.js" type="text/javascript"></script>
    <script src="./11500811g_files/gist-82c07a332f363251c445c3b10af014e4f09468d8.js" type="text/javascript"></script><script type="text/javascript" async="" src="./11500811g_files/ga.js"></script>
    

    
  
  <link href="https://github.com/api/oembed?format=json&url=https%3A%2F%2Fgist.github.com%2F1929927" rel="alternate" title="gist: 1929927" type="application/json+oembed">
  

  </head><link type="text/css" rel="stylesheet" href="data:text/css,">

  <body class="">
    <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="https://gist.github.com/"><img alt="gist" height="45" src="./11500811g_files/logo_gist.png" width="164"></a>
          </div>

            



    <div class="userbox">
      <div class="avatarname">
        <a href="https://github.com/edwardtoday"><img height="20" src="./11500811g_files/71ad5da0dd03afb5ccd7a4f3f5ceec75" width="20"></a>
        <a href="https://github.com/edwardtoday" class="name">edwardtoday</a>
      </div>
      <ul class="usernav">
        <li><a href="https://github.com/">Dashboard</a></li>
        <li>
          <a href="https://github.com/inbox/notifications">Inbox</a>
          <a href="https://github.com/inbox/notifications" class="unread_count ">0</a>
        </li>
        <li><a href="https://github.com/account">Account Settings</a></li>
        <li><a href="https://gist.github.com/logout">Log Out</a></li>
      </ul>
    </div><!-- /.userbox -->




          <div class="topsearch">
<form action="https://gist.github.com/gists/search" id="top_search_form" method="get">              <input type="search" name="q" value="" results="5" class="search placeholder" placeholder="Search Gists…"> <input type="submit" value="Search" class="button">
              <input type="hidden" name="page" value="1">
</form>
            <ul class="nav">
              <li><a href="https://gist.github.com/">New Gist</a></li>
                <li><a href="https://gist.github.com/mine">My Gists</a>
                </li><li><a href="https://gist.github.com/starred">Starred Gists</a>
              </li><li><a href="https://gist.github.com/gists">All Gists</a></li>
              <li><a href="https://github.com/">Back to GitHub</a></li>
            </ul>
          </div><!-- /.topsearch -->
        </div>
      </div>

    <div class="site">
      
<div class="secondary">

  <div id="owner">
      <div class="actor">
        <div class="gravatar">
          <img height="30" src="./11500811g_files/71ad5da0dd03afb5ccd7a4f3f5ceec75" width="30">
        </div>
        <div class="name"><a href="https://gist.github.com/edwardtoday">edwardtoday</a> <span>(owner)</span></div>
      </div>
  </div>



  <div id="revisions">
    <h3>Revisions</h3>
    <ul>
        <li class="current">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/dea85bbda406c2d61aa182c82de9e15e7fb99fe3" class="id" rel="nofollow">dea85b</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T06:30:36-08:00" title="2012-02-29 06:30:36">just now</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/7bc719d36b6d3adfd059dc29fa31c69056417577" class="id" rel="nofollow">7bc719</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T06:25:26-08:00" title="2012-02-29 06:25:26">6 minutes ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/4741d3b3ebeb01d908115cdae5096a616968d75f" class="id" rel="nofollow">4741d3</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T05:41:33-08:00" title="2012-02-29 05:41:33">an hour ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/48579a69ea6a6af7d82b5c2fe24c62242d31c1e0" class="id" rel="nofollow">48579a</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T05:31:16-08:00" title="2012-02-29 05:31:16">an hour ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/a1a68385f00caabcbbb30abf54ae577ff46a62b0" class="id" rel="nofollow">a1a683</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T05:28:04-08:00" title="2012-02-29 05:28:04">an hour ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/777c4d3ba9d1d6808d84c1cd19f69ca06fb12c20" class="id" rel="nofollow">777c4d</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T04:36:46-08:00" title="2012-02-29 04:36:46">2 hours ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/1b0d98a0293c4daa4ba5e72f452700a69c180962" class="id" rel="nofollow">1b0d98</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T03:50:02-08:00" title="2012-02-29 03:50:02">3 hours ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/b7053efd14426ea6754987d2716e0122edef33c5" class="id" rel="nofollow">b7053e</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T03:45:03-08:00" title="2012-02-29 03:45:03">3 hours ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/75d01a098ceb095b08c3de4604c85458bce090ba" class="id" rel="nofollow">75d01a</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T03:25:32-08:00" title="2012-02-29 03:25:32">3 hours ago</time></span>
        </li>
        <li class="other">
          <img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_green.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_red.png"><img alt="" src="./11500811g_files/dot_gray.png"><img alt="" src="./11500811g_files/dot_gray.png">
          <a href="https://gist.github.com/1929927/2cd54c5952f26f603ffe8c155d07fa46e121c17d" class="id" rel="nofollow">2cd54c</a>

            <a href="https://gist.github.com/edwardtoday" class="author">edwardt...</a>
          <span class="date"><time class="js-relative-date" datetime="2012-02-29T03:17:32-08:00" title="2012-02-29 03:17:32">3 hours ago</time></span>
        </li>
    </ul>
  </div>
</div><!-- /.secondary -->

<div class="main">
  <div id="repos" class="readability-header">
    <div class="repo public">
      <div class="title">
        <div class="path">
          gist: 1929927

            <a href="https://gist.github.com/gists/1929927/edit"><img alt="edit" class="button" src="./11500811g_files/edit_button.png"></a>

            <a href="https://gist.github.com/gists/1929927/download"><img alt="Download_button" border="0" class="button" src="./11500811g_files/download_button.png"></a>

            <a href="https://gist.github.com/star/1929927" data-method="post"><img alt="star" class="button" src="./11500811g_files/star_button.png"></a>
        </div>

          <div class="security public_security" style="">
            <a href="https://gist.github.com/1929927#public_repo" rel="facebox"><img alt="public" src="./11500811g_files/public.png"></a>
          </div>

        <div id="private_repo" class="hidden">
          <h2>Private Gist</h2>
          <p>
            All pages are served over SSL and all pushing and pulling is done over SSH.
            No one may fork, clone, or view it unless they are given this private URL.
          </p>
          <p>Every gist with this icon (<img alt="private" src="./11500811g_files/private.png">) is private.</p>
        </div>
        <div class="security public_security" style="display:none">
          <a href="https://gist.github.com/1929927#public_repo" rel="facebox"><img alt="public" src="./11500811g_files/public.png"></a>
        </div>
        <div id="public_repo" class="hidden">
          <h2>Public Gist</h2>
          <p>Anyone may fork, clone, or view it.</p>
          <p>Every repository with this icon (<img alt="public" src="./11500811g_files/public.png">) is public.</p>
        </div>
      </div>

      <div class="meta">
        <table>
          <tbody><tr>
            <td class="label">Description:</td>
            <td>
              <div class="description">
                <span id="description" class="edit instapaper_title">WebDB Assignment 1</span>
<form action="https://gist.github.com/gists/1929927" class="edit_gist" id="edit_gist_1929927" method="post" style="display:none"><div style="margin:0;padding:0;display:inline"><input name="_method" type="hidden" value="put"><input name="authenticity_token" type="hidden" value="sfsib+2mogDgc4KIjEu6jbnJtggUW13qTOO65gv+RdU="></div>                    <input id="gist_description" name="gist[description]" size="30" type="text" value="WebDB Assignment 1">
                    <input id="gist_submit" name="commit" type="submit" value="save">
</form>                  <a href="https://gist.github.com/1929927#description" class="edit action" title="edit gist description">edit</a>
              </div>
            </td>
          </tr>

            <tr>
              <td class="label">Public Clone URL:</td>
              <td>
                <a rel="#git-clone" class="git_url_facebox" href="git://gist.github.com/1929927.git">git://gist.github.com/1929927.git</a>
                <div id="git-clone" style="display:none; min-width:500px">
                  Give this clone URL to anyone.
                  <br>

                  <code>git clone git://gist.github.com/1929927.git gist-1929927</code>
                </div>
              </td>
            </tr>

            <tr>
              <td class="label">Private Clone URL:</td>
              <td>
                <div id="private-clone-url">
                  <a class="git_url_facebox" rel="#git-private-clone">git@gist.github.com:1929927.git</a>
                  <input type="text" value="git@gist.github.com:1929927.git" style="display: none;">
                </div>
                <div id="git-private-clone" style="display:none; min-width:500px">
                  Use this clone URL yourself.
                  <br>
                  <code>git clone git@gist.github.com:1929927.git gist-1929927</code>
                </div>
              </td>
            </tr>

            <tr>
              <td class="label">Embed All Files:</td>
              <td>
                <a href="https://gist.github.com/1929927#" class="gist-embed-link">show embed</a>
                <input class="gist-embed-box" type="text" size="25" value="&lt;script src=&quot;https://gist.github.com/1929927.js&quot;&gt; &lt;/script&gt;" style="display:none;">
              </td>
            </tr>

        </tbody></table>
      </div>
    </div>
  </div>

  <div id="files" class="instapaper_body">

        <div class="file" id="file_11500811g_5323_assign1.markdown">
  <div class="meta clearfix instapaper_ignore readability-extra">
    <div class="info">
      <span class="code">
          11500811g_5323_assign1.markdown
        <a href="./11500811g_files/11500811g.html">#</a>
      </span>
    </div>
    <div class="actions">
      <div id="gist-embed" style="display:inline;">
        <a href="https://gist.github.com/1929927#" class="gist-embed-link">embed</a>
        <input class="gist-embed-box" type="text" size="25" value="&lt;script src=&quot;https://gist.github.com/1929927.js?file=11500811g_5323_assign1.markdown&quot;&gt;&lt;/script&gt;" style="display:none;">
      </div>
      <a href="https://gist.github.com/raw/1929927/b39d4a6685d9e52b4db34e0f420f5e889eafa79f/11500811g_5323_assign1.markdown">raw</a>
    </div>
  </div>
  
  <div id="readme" class="blob instapaper_body">
    <article class="markdown-body"><h1>Solution to WebDB Assignment 1 (Spring 2012)</h1>
<blockquote>
<p><strong>11500811g QING Pei</strong><br><a href="mailto:pei.qing@connect.polyu.hk">pei.qing@connect.polyu.hk</a><br>
2012-02-29</p>
</blockquote>
<h2>Question 1 - Schema Design with IBM DB2</h2>

<h3>(a)</h3>

<h4>XPath</h4>

<pre lang="xpath"><code>/forms/form/leader[mode="Full"][department="COMP"]/name/text()
</code></pre>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="k">for</span> <span class="nv">$l</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">leader</span>
<span class="k">where</span> <span class="nv">$l</span><span class="p">/</span><span class="nv">department</span><span class="o">=</span><span class="s2">"COMP"</span> <span class="ow">and</span> <span class="nv">$l</span><span class="p">/</span><span class="nv">mode</span><span class="o">=</span><span class="s2">"Full"</span>
<span class="k">return</span> <span class="nv">$l</span><span class="p">/</span><span class="nv">name</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f612e706e67" alt="XQuery result a"></p>

<h3>(b)</h3>

<h4>XPath</h4>

<pre lang="xpath"><code>count(//form[members/group_member/name=//leader/name])
</code></pre>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="k">let</span> <span class="nv">$f</span><span class="o">:=</span><span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)/</span><span class="nv">forms</span>
<span class="k">let</span> <span class="nv">$m</span><span class="o">:=</span><span class="nv">$f</span><span class="p">/</span><span class="nv">form</span><span class="p">//</span><span class="nv">group_member</span>
<span class="k">for</span> <span class="nv">$l</span> <span class="ow">in</span> <span class="nv">$f</span><span class="p">/</span><span class="nv">form</span><span class="p">/</span><span class="nv">leader</span>
<span class="k">where</span> <span class="nv">$l</span><span class="p">/</span><span class="nv">name</span><span class="o">=</span><span class="nv">$m</span><span class="p">/</span><span class="nv">name</span>
<span class="k">return</span> <span class="nf">count</span><span class="p">(</span><span class="nv">$l</span><span class="p">)</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f622e706e67" alt="XQuery result b"></p>

<h3>(c)</h3>

<h4>XPath</h4>

<pre lang="xpath"><code>//details[activity_item//date/text()="2012-06-20"]/project_name
</code></pre>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="k">for</span> <span class="nv">$d</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">details</span>
<span class="k">where</span> <span class="nv">$d</span><span class="p">/</span><span class="nv">activity_item</span><span class="p">//</span><span class="nv">date</span><span class="p">/</span><span class="nf">text</span><span class="p">()</span><span class="o">=</span><span class="s2">"2012-06-20"</span>
<span class="k">return</span> <span class="nv">$d</span><span class="p">/</span><span class="nv">project_name</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f632e706e67" alt="XQuery result c"></p>

<h3>(d)</h3>

<h4>XPath</h4>

<p>Not applicable.</p>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="k">let</span> <span class="nv">$pool</span> <span class="o">:=</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">details</span><span class="p">[</span><span class="nv">activity_item</span><span class="p">//</span><span class="nv">date</span><span class="p">/</span><span class="nf">text</span><span class="p">()</span><span class="o">=</span><span class="s2">"2012-06-20"</span><span class="p">]</span>
<span class="k">for</span> <span class="nv">$index</span> <span class="ow">in</span> <span class="mi">1</span> <span class="k">to</span> <span class="nf">count</span><span class="p">(</span><span class="nv">$pool</span><span class="p">)</span>
<span class="k">where</span> <span class="nv">$index</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
<span class="nv">$pool</span><span class="p">[</span><span class="nv">$index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]//</span><span class="nv">activity_item</span><span class="p">[//</span><span class="nv">date</span><span class="p">/</span><span class="nf">text</span><span class="p">()</span><span class="o">=</span><span class="s2">"2012-06-20"</span><span class="p">]/</span><span class="nv">place</span> <span class="o">=</span> 
<span class="nv">$pool</span><span class="p">[</span><span class="nv">$index</span><span class="p">]//</span><span class="nv">activity_item</span><span class="p">[//</span><span class="nv">date</span><span class="p">/</span><span class="nf">text</span><span class="p">()</span><span class="o">=</span><span class="s2">"2012-06-20"</span><span class="p">]/</span><span class="nv">place</span>
<span class="k">return</span>
<span class="nt">&lt;pair&gt;</span><span class="l"></span>
<span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$pool</span><span class="p">[</span><span class="nv">$index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]/</span><span class="nv">project_name</span><span class="p">)}</span><span class="l">, </span><span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$pool</span><span class="p">[</span><span class="nv">$index</span><span class="p">]/</span><span class="nv">project_name</span><span class="p">)}</span><span class="l"></span>
<span class="nt">&lt;/pair&gt;</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f642e706e67" alt="XQuery result d"></p>

<h3>(e)</h3>

<h4>XPath</h4>

<pre lang="xpath"><code>//form[.//total_expenditure/applied&gt;30000][count(.//activity_item)&lt;3]/details/project_name
</code></pre>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="k">for</span> <span class="nv">$d</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">form</span><span class="p">[.//</span><span class="nv">total_expenditure</span><span class="p">/</span><span class="nv">applied</span><span class="o">&gt;</span><span class="mi">30000</span><span class="p">][</span><span class="nf">count</span><span class="p">(.//</span><span class="nv">activity_item</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">]/</span><span class="nv">details</span>
<span class="k">return</span> <span class="nv">$d</span><span class="p">/</span><span class="nv">project_name</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f652e706e67" alt="XQuery result e"></p>

<h3>(f)</h3>

<h4>XPath</h4>

<p>Not applicable.</p>

<h4>XQuery</h4>

<div class="highlight">
<pre><span class="nt">&lt;group&gt;</span><span class="l"></span>
<span class="p">{</span>
<span class="k">for</span> <span class="nv">$f</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">forms</span><span class="p">/</span><span class="nv">form</span>
<span class="k">let</span> <span class="nv">$sum</span> <span class="o">:=</span> <span class="nf">sum</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">activity_item</span><span class="p">/</span><span class="nv">number_of_user</span><span class="p">)</span>
<span class="k">where</span> <span class="nv">$sum</span> <span class="o">&lt;</span> <span class="mi">100</span>
<span class="k">return</span> 
<span class="nt">&lt;project&gt;</span><span class="l"></span>
<span class="nt">&lt;name&gt;</span><span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">project_name</span><span class="p">)}</span><span class="nt">&lt;/name&gt;</span><span class="l">,</span>
<span class="nt">&lt;users&gt;</span><span class="p">{</span><span class="nv">$sum</span><span class="p">}</span><span class="nt">&lt;/users&gt;</span><span class="l"></span>
<span class="nt">&lt;peruser&gt;</span><span class="p">{</span><span class="nv">$f</span><span class="p">//</span><span class="nv">total_expenditure</span><span class="p">/</span><span class="nv">applied</span> <span class="k">div</span> <span class="nv">$sum</span><span class="p">}</span><span class="nt">&lt;/peruser&gt;</span><span class="l"></span>
<span class="nt">&lt;/project&gt;</span>
<span class="p">}</span><span class="l"></span>
<span class="nt">&lt;/group&gt;</span>
<span class="p">,</span>
<span class="nt">&lt;group&gt;</span><span class="l"></span>
<span class="p">{</span>
<span class="k">for</span> <span class="nv">$f</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">forms</span><span class="p">/</span><span class="nv">form</span>
<span class="k">let</span> <span class="nv">$sum</span> <span class="o">:=</span> <span class="nf">sum</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">activity_item</span><span class="p">/</span><span class="nv">number_of_user</span><span class="p">)</span>
<span class="k">where</span> <span class="nv">$sum</span> <span class="o">&lt;</span> <span class="mi">1000</span> <span class="ow">and</span> <span class="nv">$sum</span> <span class="o">&gt;</span> <span class="mi">100</span>
<span class="k">return</span> 
<span class="nt">&lt;project&gt;</span><span class="l"></span>
<span class="nt">&lt;name&gt;</span><span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">project_name</span><span class="p">)}</span><span class="nt">&lt;/name&gt;</span><span class="l">,</span>
<span class="nt">&lt;users&gt;</span><span class="p">{</span><span class="nv">$sum</span><span class="p">}</span><span class="nt">&lt;/users&gt;</span><span class="l"></span>
<span class="nt">&lt;/project&gt;</span>
<span class="p">}</span><span class="l"></span>
<span class="nt">&lt;/group&gt;</span>
<span class="p">,</span>
<span class="nt">&lt;group&gt;</span><span class="l"></span>
<span class="p">{</span>
<span class="k">for</span> <span class="nv">$f</span> <span class="ow">in</span> <span class="nf">db2-fn:xmlcolumn</span><span class="p">(</span><span class="s1">'PSUDO_DATA.PSUDO_DATA_TABLE'</span><span class="p">)//</span><span class="nv">forms</span><span class="p">/</span><span class="nv">form</span>
<span class="k">let</span> <span class="nv">$sum</span> <span class="o">:=</span> <span class="nf">sum</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">activity_item</span><span class="p">/</span><span class="nv">number_of_user</span><span class="p">)</span>
<span class="k">where</span> <span class="nv">$sum</span> <span class="o">&gt;</span> <span class="mi">1000</span>
<span class="k">return</span> 
<span class="nt">&lt;project&gt;</span><span class="l"></span>
<span class="nt">&lt;name&gt;</span><span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$f</span><span class="p">//</span><span class="nv">project_name</span><span class="p">)}</span><span class="nt">&lt;/name&gt;</span><span class="l">,</span>
<span class="nt">&lt;users&gt;</span><span class="p">{</span><span class="nv">$sum</span><span class="p">}</span><span class="nt">&lt;/users&gt;</span><span class="l"></span>
<span class="nt">&lt;/project&gt;</span>
<span class="p">}</span><span class="l"></span>
<span class="nt">&lt;/group&gt;</span>
</pre>
</div>


<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f66312e706e67" alt="XQuery result f part1">

continued...
<img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f66322e706e67" alt="XQuery result f part2">

continued...
<img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f66332e706e67" alt="XQuery result f part2"></p>

<h2>Question 2 - DTD</h2>

<p>The DTD is designed as the following.</p>

<div class="highlight">
<pre><span class="err">&lt;</span><span class="o">?</span><span class="err">xml</span> <span class="err">version=</span><span class="s2">"1.0"</span> <span class="err">encoding=</span><span class="s2">"UTF-8"</span><span class="o">?</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">dags</span> <span class="o">(</span><span class="nt">dag</span><span class="o">*)</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">dag</span> <span class="o">(</span><span class="nt">nodes</span><span class="o">,</span> <span class="nt">edges</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">dag</span> <span class="na">name</span> <span class="kc">ID</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">nodes</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">nodes</span> <span class="na">labels</span> <span class="kc">IDREFS</span> <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">edges</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">edges</span> <span class="na">labels</span> <span class="kc">IDREFS</span> <span class="kc">#IMPLIED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">node</span> <span class="o">(</span><span class="kc">#PCDATA</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">node</span> <span class="na">label</span> <span class="kc">ID</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">edge</span> <span class="o">(</span><span class="nt">head_node</span><span class="o">,</span> <span class="nt">tail_node</span><span class="o">,</span> <span class="nt">weight</span><span class="o">)</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">edge</span> <span class="na">id</span> <span class="kc">ID</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">head_node</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">head_node</span> <span class="na">label</span> <span class="kc">IDREF</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">tail_node</span> <span class="kc">EMPTY</span><span class="k">&gt;</span>
<span class="k">&lt;!ATTLIST</span> <span class="nt">tail_node</span> <span class="na">label</span> <span class="kc">IDREF</span> <span class="kc">#REQUIRED</span><span class="k">&gt;</span>
<span class="k">&lt;!ELEMENT</span> <span class="nt">weight</span> <span class="o">(</span><span class="kc">#PCDATA</span><span class="o">)</span><span class="k">&gt;</span>
</pre>
</div>


<p>Being acyclic means there is no edge from a node to any of its ancestors. DTD cannot model the acyclic property. The schema languages only apply constraints on the content of data, with little limitations on their relationship with other context. The identity constraints using ID and IDREF can only force the nodes and edges to be unique, i.e. no duplicate edges from $node_i$ to $node_j$ can be inserted. With an edge from $node_i$ to $node_j$ existing in a graph, the constrains cannot even prevent another edge from $node_j$ to $node_i$ from being inserted, not to mention any limits on the IDREFS attributes of the <em>nodes</em> and <em>edges</em> elements.</p>

<p>The approach I currently regard as feasible is to check upon edge insertions. The reason for that is given below.</p>

<ul>
<li>Inserting a orphaned node to the existing graphs does not create any cycles.</li>
<li>Inserting an edge from $node_i$ to $node_j$ to a graph $G$ does not affect other graphs that has no reference to this edge.</li>
</ul><p>Therefore, we only need to check the DAG which the new edge is inserted into. (Bulk insertion into multiple DAGs can be treated as a sequence of individual insertions. Then for each individual insertion, the procedure is the same.) Here is the procedure for checking.</p>

<ol>
<li>Select the DAG involving the edge insertion.</li>
<li>Form an <a href="http://en.wikipedia.org/wiki/Adjacency_matrix">adjacency matrix</a> A that fully represents the DAG with $A_{ij}$ as the edge weight from $node_i$ to $node_j$. A weight of 0 means there is no such edge.

<ul>
<li>Actually, only a boolean (weight == 0) is necessary to check for cycles. The weight does not offer extra help here.</li>
</ul>
</li>
<li>Then use <a href="http://en.wikipedia.org/wiki/Topological_sorting#Algorithms">topological sorting algorithm</a> by <a href="http://dx.doi.org/10.1145%2F368996.369025">Kahn, A. B. (1962)</a> to test if the graph has at least one cycle.</li>
<li>If any error occurs, break and reject the edge to be inserted.</li>
</ol><p>Kahn's algorithm:</p>

<pre><code>L ← Empty list that will contain the sorted elements
S ← Set of all nodes with no incoming edges
while S is non-empty do
    remove a node n from S
    insert n into L
    for each node m with an edge e from n to m do
        remove edge e from the graph
        if m has no other incoming edges then
            insert m into S
if graph has edges then
    return error (graph has at least one cycle)
else 
    return L (a topologically sorted order)
</code></pre>

<h2>Question 3 - Schema Design</h2>

<h3>Schema</h3>

<p>Here is the XML schema designed for the show.</p>

<div class="highlight">
<pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;xs:schema</span> <span class="na">xmlns:t=</span><span class="s">"http://qingpei.me/COMP5323"</span>
<span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span>
<span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span>
<span class="na">targetNamespace=</span><span class="s">"http://qingpei.me/COMP5323"</span>
<span class="na">elementFormDefault=</span><span class="s">"qualified"</span> <span class="na">attributeFormDefault=</span><span class="s">"unqualified"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"show"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:sequence&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"xs:string"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">ref=</span><span class="s">"t:episode"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">ref=</span><span class="s">"t:star_chef"</span> <span class="na">minOccurs=</span><span class="s">"4"</span>
        <span class="na">maxOccurs=</span><span class="s">"unbounded"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">ref=</span><span class="s">"t:ingredient"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">ref=</span><span class="s">"t:challenger"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;/xs:sequence&gt;</span>
    <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"episode_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:episode"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:number"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"chef_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:star_chef"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:name"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"challenger_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:challenger"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:name"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:restaurant"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"ingredient_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:ingredient"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:id"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:keyref</span> <span class="na">name=</span><span class="s">"episode_idref"</span> <span class="na">refer=</span><span class="s">"t:episode_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:star_chef/t:episode_appeared"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@ref"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:keyref&gt;</span>
    <span class="nt">&lt;xs:keyref</span> <span class="na">name=</span><span class="s">"chef_idref"</span> <span class="na">refer=</span><span class="s">"t:chef_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:episode/t:star_chef|t:episode/t:challenged_chef"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@ref"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:keyref&gt;</span>
    <span class="nt">&lt;xs:keyref</span> <span class="na">name=</span><span class="s">"challenger_idref"</span> <span class="na">refer=</span><span class="s">"t:challenger_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:episode/t:challenger"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@key1"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@key2"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:keyref&gt;</span>
    <span class="nt">&lt;xs:keyref</span> <span class="na">name=</span><span class="s">"ingredient_idref"</span> <span class="na">refer=</span><span class="s">"t:ingredient_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:episode/t:ingredient"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@ref"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:keyref&gt;</span>
    <span class="nt">&lt;xs:unique</span> <span class="na">name=</span><span class="s">"ingredient"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:episode/t:ingredient"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@ref"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:unique&gt;</span>
  <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"episode"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:complexContent&gt;</span>
        <span class="nt">&lt;xs:extension</span> <span class="na">base=</span><span class="s">"t:episodeType"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;/xs:complexContent&gt;</span>
    <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"judge_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:judge"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:name"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:key</span> <span class="na">name=</span><span class="s">"star_id"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:star_chef|t:challenged_chef"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"@ref"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:key&gt;</span>
    <span class="nt">&lt;xs:unique</span> <span class="na">name=</span><span class="s">"judge_name"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:selector</span> <span class="na">xpath=</span><span class="s">"t:judge"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:field</span> <span class="na">xpath=</span><span class="s">"t:name"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:unique&gt;</span>
  <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"episodeType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"number"</span> <span class="na">type=</span><span class="s">"xs:positiveInteger"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"star_chef"</span> <span class="na">type=</span><span class="s">"t:refType"</span> <span class="na">minOccurs=</span><span class="s">"3"</span>
      <span class="na">maxOccurs=</span><span class="s">"3"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"challenged_chef"</span> <span class="na">type=</span><span class="s">"t:refType"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"challenger"</span> <span class="na">type=</span><span class="s">"t:doubleRefType"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"ingredient"</span> <span class="na">type=</span><span class="s">"t:refType"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"judge"</span> <span class="na">minOccurs=</span><span class="s">"4"</span> <span class="na">maxOccurs=</span><span class="s">"4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xs:complexType&gt;</span>
          <span class="nt">&lt;xs:sequence&gt;</span>
            <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"xs:string"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"score_star"</span> <span class="na">type=</span><span class="s">"t:scoreType"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"score_challenger"</span>
            <span class="na">type=</span><span class="s">"t:scoreType"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/xs:sequence&gt;</span>
        <span class="nt">&lt;/xs:complexType&gt;</span>
      <span class="nt">&lt;/xs:element&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"winner_is_challenger"</span> <span class="na">type=</span><span class="s">"xs:boolean"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"star_chef"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:complexContent&gt;</span>
        <span class="nt">&lt;xs:extension</span> <span class="na">base=</span><span class="s">"t:personType"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xs:sequence&gt;</span>
            <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"episode_appeared"</span> <span class="na">type=</span><span class="s">"t:refType"</span>
            <span class="na">maxOccurs=</span><span class="s">"unbounded"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/xs:sequence&gt;</span>
        <span class="nt">&lt;/xs:extension&gt;</span>
      <span class="nt">&lt;/xs:complexContent&gt;</span>
    <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"personType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"xs:string"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"refType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:attribute</span> <span class="na">name=</span><span class="s">"ref"</span> <span class="na">use=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"ingredient"</span> <span class="na">type=</span><span class="s">"t:ingredientType"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"ingredientType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"xs:positiveInteger"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"xs:string"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"challengerType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:complexContent&gt;</span>
      <span class="nt">&lt;xs:extension</span> <span class="na">base=</span><span class="s">"t:personType"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xs:sequence&gt;</span>
          <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"restaurant"</span> <span class="na">type=</span><span class="s">"xs:string"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;/xs:sequence&gt;</span>
      <span class="nt">&lt;/xs:extension&gt;</span>
    <span class="nt">&lt;/xs:complexContent&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"challenger"</span> <span class="na">type=</span><span class="s">"t:challengerType"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"doubleRefType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:attribute</span> <span class="na">name=</span><span class="s">"key1"</span> <span class="na">use=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;xs:attribute</span> <span class="na">name=</span><span class="s">"key2"</span> <span class="na">use=</span><span class="s">"required"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"scoreType"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:sequence&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"taste"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xs:simpleType&gt;</span>
          <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:int"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xs:minInclusive</span> <span class="na">value=</span><span class="s">"0"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;xs:maxInclusive</span> <span class="na">value=</span><span class="s">"20"</span> <span class="nt">&gt;</span>
          <span class="nt">&lt;/xs:restriction&gt;</span>
        <span class="nt">&lt;/xs:simpleType&gt;</span>
      <span class="nt">&lt;/xs:element&gt;</span>
      <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"appearance"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xs:simpleType&gt;</span>
          <span class="nt">&lt;xs:restriction</span> <span class="na">base=</span><span class="s">"xs:int"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xs:minInclusive</span> <span class="na">value=</span><span class="s">"0"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;xs:maxInclusive</span> <span class="na">value=</span><span class="s">"20"</span> <span class="nt">&gt;</span>
          <span class="nt">&lt;/xs:restriction&gt;</span>
        <span class="nt">&lt;/xs:simpleType&gt;</span>
      <span class="nt">&lt;/xs:element&gt;</span>
    <span class="nt">&lt;/xs:sequence&gt;</span>
  <span class="nt">&lt;/xs:complexType&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</pre>
</div>


<ul>
<li>xs:key to eliminate duplicate star chefs in the entire show.</li>
<li>xs:key combined with name and restaurant to identify a unique challenger.</li>
<li>xs:unique to ensure the 4 stars in a single episode are different.</li>
<li>xs:keyref where applicable to ensure data inputs are valid keys in the scope.</li>
</ul><h3>XQuery to Find the Top Chef</h3>

<p>In the design philosophy of the above schema, I thought it would be better if each <em>star_chef</em> element holds a reference to all episodes that chef has shown up while the <em>episode</em> element holds references to the chefs in that particular episode. By cross-referencing these elements, it would be easier to query all the data about a given star_chef without having to traverse every episode.</p>

<p>The additional information stored in the xml file does make the insertion operation more complicated and a little bit more time consuming. However, that may speed up queries. In my opinion, sacrificing the write access time for faster queries is worthy. There would be far more queries than database updates.</p>

<p>The query to find the top chef can be written like this:</p>

<div class="highlight">
<pre><span class="k">declare</span> <span class="k">namespace</span> <span class="nn">t</span> <span class="o">=</span> <span class="s2">"http://qingpei.me/COMP5323"</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">$c</span> <span class="ow">in</span> <span class="nf">doc</span><span class="p">(</span><span class="s2">"show.xml"</span><span class="p">)/</span><span class="nv">t:show</span><span class="p">/</span><span class="nv">t:star_chef</span>
<span class="k">order by</span> <span class="nf">count</span><span class="p">(</span><span class="nv">$c</span><span class="p">/</span><span class="nv">t:episode_appeared</span><span class="p">)</span> <span class="k">descending</span>
<span class="k">return</span>
    <span class="nt">&lt;p&gt;</span><span class="p">{</span><span class="nf">data</span><span class="p">(</span><span class="nv">$c</span><span class="p">/</span><span class="nv">t:name</span><span class="p">)}</span><span class="l"> , </span><span class="p">{</span><span class="nf">count</span><span class="p">(</span><span class="nv">$c</span><span class="p">/</span><span class="nv">t:episode_appeared</span><span class="p">)}</span><span class="nt">&lt;/p&gt;</span>
</pre>
</div>


<p>It is also feasible to get the same result without using <em>episode_appeared</em> information of each chef but looking for things in the episode subtrees.</p>

<div class="highlight">
<pre><span class="k">declare</span> <span class="k">namespace</span> <span class="nn">t</span> <span class="o">=</span> <span class="s2">"http://qingpei.me/COMP5323"</span><span class="p">;</span>

<span class="k">let</span> <span class="nv">$d</span> <span class="o">:=</span> <span class="nf">doc</span><span class="p">(</span><span class="s2">"show.xml"</span><span class="p">)</span>
<span class="k">for</span> <span class="nv">$name</span> <span class="ow">in</span> <span class="nv">$d</span><span class="p">/</span><span class="nv">t:show</span><span class="p">//</span><span class="nv">t:star_chef</span><span class="p">/</span><span class="nv">t:name</span>
    <span class="k">let</span> <span class="nv">$ep</span> <span class="o">:=</span> <span class="nv">$d</span><span class="p">/</span><span class="nv">t:show</span><span class="p">/</span><span class="nv">t:episode</span>
    <span class="k">let</span> <span class="nv">$pool</span> <span class="o">:=</span> <span class="nv">$ep</span><span class="p">/</span><span class="nv">t:star_chef</span> <span class="o">|</span> <span class="nv">$ep</span><span class="p">/</span><span class="nv">t:challenged_chef</span>
    <span class="k">let</span> <span class="nv">$count</span> <span class="o">:=</span> <span class="nf">count</span><span class="p">(</span><span class="nv">$pool</span><span class="p">[</span><span class="na">@ref</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">])</span>
    <span class="k">order by</span> <span class="nv">$count</span>  <span class="k">descending</span>
<span class="k">return</span>
    <span class="nt">&lt;chef&gt;</span><span class="p">{</span><span class="nv">$name</span><span class="p">/</span><span class="nf">text</span><span class="p">()}</span><span class="l">, </span><span class="p">{</span><span class="nv">$count</span> <span class="p">}</span><span class="nt">&lt;/chef&gt;</span>
</pre>
</div>


<h3>Many-to-many relationship in XML Schema</h3>

<p>To model a many-to-many relationship in XML Schema, the following ways are possible:</p>

<ol>
<li>When an element is related to another, store a copy of it in the target.

<ul>
<li>Pros

<ul>
<li>All the related data are physically stored together. Accessing is more sequential.</li>
</ul>
</li>
<li>Cons

<ul>
<li>All occurrences have to be taken care of when add/modify/remove anything that is not isolated.</li>
<li>Inefficient storage usage with much duplication in data.</li>
</ul>
</li>
</ul>
</li>
<li>Use xs:ID and xs:IDREF or use xs:key and xs:keyref to store only the references to the elements related.

<ul>
<li>Pros

<ul>
<li>No duplicate data.</li>
<li>Less mismatches. Only existing elements can be referred to.</li>
</ul>
</li>
<li>Cons

<ul>
<li>Random accesses following the references.</li>
</ul>
</li>
</ul>
</li>
<li>Add extra entities to store the relationships, converting the relationship to 1:N.

<ul>
<li>Pros

<ul>
<li>Easier to access all the relationships.</li>
</ul>
</li>
<li>Cons

<ul>
<li>The tree structure changes to a less intuitive one.</li>
</ul>
</li>
</ul>
</li>
</ol><h2>Question 4 - Oracle and another XML DB</h2>

<p>Comparison of XML support between Sedna and Oracle XML DB.</p>

<h3>Storage Method</h3>

<h4>Sedna</h4>

<p>The Sedna Database stores the following objects:</p>

<ul>
<li>Database</li>
<li>Collection and Stand-alone document</li>
<li>Document in Collection</li>
</ul><p>Data are stored in blocks chained into bidirectional lists.</p>

<ul>
<li>Node descriptors are ordered across blocks according to document order.</li>
<li>Bi-directional references from the descriptive schema node to/from the block.</li>
</ul><p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f5365646e612d786d6c2d646f63756d656e742d636c757374657265642e706e67" alt="Data block"></p>

<h4>Oracle XML DB</h4>

<p>The two main features in Oracle XML DB architecture are:</p>

<ul>
<li>XMLType tables and views storage

<ul>
<li>When XML Schema are registered with Oracle XML DB, XML elements for XMLType tables, tables with XMLType columns, and XMLType views, are mapped to database tables. These can be viewed and accessed in XML repository.</li>
<li>Data in XMLType tables and tables with XMLType columns can be stored in Character Large Objects (CLOB) or natively using structured XML.</li>
<li>Data in XMLType views can be stored in local tables or remote tables. The latter can be accessed through DBLinks.</li>
<li>Both XMLType tables and views can be indexed using B*Tree, Oracle Text, function-based, or bitmap indexes.</li>
</ul>
</li>
</ul><p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f61647864623031372e676966" alt="Oracle XML DB Architecture: XMLType Storage and Repository"></p>

<ul>
<li>Oracle XML DB repository, also referred to in this manual as XML repository or repository

<ul>
<li>Oracle XML DB repository (XML repository or repository) is an XML data repository in Oracle Database optimized for handling XML data. At the heart of Oracle XML DB repository is the Oracle XML DB foldering module.</li>
</ul>
</li>
</ul><h3>Schema/DTD</h3>

<h4>Sedna</h4>

<p>By default an XMLReader does not parse Comments, CDATA or DTD Declarations. However the Sedna XML:DB API can (with a tweak).</p>

<p>A descriptive schema-driven storage strategy is developed which consists of clustering nodes of an XML document according to their positions in the descriptive schema of the document. In contrast to a prescriptive schema that is known in advance and is usually specified in DTD or XML Schema, the descriptive schema is generated from data dynamically (and is maintained incrementally) and represents a concise and an accurate structure summary for data. Using the descriptive schema instead of the prescriptive one makes the storage strategy applicable to any XML document, even a one that comes with no prescriptive schema.</p>

<h4>Oracle XML DB</h4>

<p>Oracle XML DB uses annotated XML Schema as metadata, that is, the standard XML Schema definitions along with several Oracle XML DB-defined attributes. These attributes control how instance XML documents get mapped to the database. Because these attributes are in a different namespace from the XML Schema namespace, such annotated XML Schemas are still legal XML Schema documents.</p>

<p>When using Oracle XML DB with XML Schema, you must first register the XML Schema. You can then use the XML Schema URLs while creating XMLType tables, columns, and views. The XML Schema URL, in other words, the URL that identifies the XML Schema in the database, is associated with the schemaurl parameter of registerSchema.</p>

<p>Oracle XML DB provides XML Schema support for the following tasks:</p>

<ul>
<li>Registering any W3C-compliant XML Schemas.</li>
<li>Validating your XML documents against a registered XML Schema definitions.</li>
<li>Registering local and global XML Schemas.</li>
<li>Generating XML Schema from object types.</li>
<li>Referencing an XML Schema owned by another user.</li>
<li>Explicitly referencing a global XML Schema when a local XML Schema exists with the same name.</li>
<li>Generating a structured database mapping from your XML Schemas during XML Schema registration. This includes generating SQL object types, collection types, and default tables, and capturing the mapping information using XML Schema attributes.</li>
<li>Specifying a particular SQL type mapping when there are multiple legal mappings.</li>
<li>Creating XMLType tables, views and columns based on registered XML Schemas.</li>
<li>Performing manipulation (DML) and queries on XML Schema-based XMLType tables.</li>
<li>Automatically inserting data into default tables when schema-based XML instances are inserted into Oracle XML DB repository using FTP, HTTP/WebDAV protocols and other languages.</li>
</ul><p>In addition to supporting XML Schema that provide a structured mapping to object- relational storage, Oracle XML DB also supports DTD specifications in XML instance documents. Though DTDs are not used to derive the mapping, XML processors can still access and interpret the DTDs.</p>

<ul>
<li>Inline DTD Definitions
When an XML instance document has an inline DTD definition, it is used during document parsing. Any DTD validations and entity declaration handling is done at this point. However, once parsed, the entity references are replaced with actual values and the original entity reference is lost.</li>
<li>External DTD Definitions
Oracle XML DB also supports external DTD definitions if they are stored in the repository. Applications needing to process an XML document containing an external DTD definition such as <code>/public/flights.dtd</code>, must first ensure that the DTD document is stored in Oracle XML DB at path <code>/public/flights.xsd</code>.</li>
</ul><h3>Query Support and Indexing</h3>

<h4>Sedna</h4>

<p>Sedna has a wide range of queries/statements support: XQuery queries, XML update statements, data definition language statements</p>

<p>The following XPath evaluations are supported.</p>

<ul>
<li>Simple absolute XPath: <code>/library/book/title</code> (descriptive schema evaluation only)</li>
<li>Absolute XPath with descendant axes: <code>/library//title</code> (descriptive schema with merge by labeling schema)</li>
<li>XPath with predicates: <code>/library/book[title=“XQuery”]/author</code>
</li>
<li>following,sibling,parent,…: <code>/library//author[text()=“Tolstoy”]/..</code>
</li>
</ul><p>Index implementations:</p>

<ul>
<li>B+-tree</li>
<li>Clusterization</li>
<li>Error counters</li>
<li>Pre-sorting during create</li>
<li>Markers on Schema</li>
</ul><p>Full-text indices and IR:</p>

<ul>
<li>Integration with external engine: <strong>dtSearch</strong>
</li>
<li>ACID support and lazy evaluation</li>
</ul><h4>Oracle XML DB</h4>

<p>The following processing options are available:</p>

<ul>
<li>XSLT</li>
<li>DOM fidelity, document fidelity.</li>
<li>XPath searching.</li>
<li>XMLType views.</li>
<li>XQuery</li>
</ul><p>A hierarchical index speeds up folder and path traversals. Oracle XML DB includes a new, patented hierarchical index that speeds up folder and path traversals in Oracle XML DB repository. The hierarchical index is transparent to end users, and allows Oracle XML DB to perform folder and path traversals at speeds comparable to or faster than conventional file systems.</p>

<p><img src="./11500811g_files/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353234393431332f57656244425f61737369676e312f61647864623033302e676966" alt="Oracle XML DB Repository Architecture"></p>

<p>One key decision to make when using Oracle XML DB for persisting XML documents is when to use structured- and when to use unstructured storage.</p>

<ul>
<li>Unstructured Storage

<ul>
<li>Text and function-based indexes.</li>
</ul>
</li>
<li>Structured Storage

<ul>
<li>
<strong>B-Tree</strong>, text and function-based indexes.</li>
</ul>
</li>
</ul><p>Oracle supports Full Text search on documents that are managed by the Oracle Database.</p>

<h3>Transaction Management</h3>

<h4>Sedna</h4>

<p>Principles</p>

<ul>
<li>ACID transactions

<ul>
<li>Atomicity – rollback procedure</li>
<li>Consistency – by design</li>
<li>Isolation – S2PL and snapshots</li>
<li>Durability – two-level recovery scheme</li>
</ul>
</li>
<li>Versioning environment

<ul>
<li>Support for Read-Only transactions</li>
<li>Physical recovery using persistent snapshot</li>
</ul>
</li>
<li>Logical recovery using log of micro-operations</li>
</ul><p>Versioning Scheme</p>

<ul>
<li>Page-level versioning

<ul>
<li>Consistent with internal representation (e.g. following the pointers)</li>
<li>Transaction-transparent solution</li>
<li>All logic is encapsulated in a separate module on SM</li>
</ul>
</li>
<li>Limited number of versions for each page

<ul>
<li>More effective maintenance and garbage collecting (4 versions on 2 snapshots)</li>
</ul>
</li>
<li>Support for snapshots to process read-only transactions

<ul>
<li>No isolation is required</li>
<li>Long-running read-only transactions cannot be rolled back due to the lack of versions</li>
</ul>
</li>
</ul><p>Isolation</p>

<ul>
<li>Usual transactions

<ul>
<li>S2PL protocol</li>
<li>Document-level granularity</li>
</ul>
</li>
<li>Read-only transactions

<ul>
<li>No isolation is required since they use transaction-consistent snapshots</li>
</ul>
</li>
</ul><h4>Oracle XML DB</h4>

<p>Oracle XML DB versioning helps keep track of all changes on version-controlled Oracle XML DB resources (VCR). The following sections discuss these features in detail. Oracle XML DB versioning features include the following:</p>

<ul>
<li>Version control on a resource.<br>
You have the option to turn on or off version control on an Oracle XML DB resource.</li>
<li>Updating process of a version-controlled resource.<br>
When Oracle XML DB updates a version-controlled resource, it also creates a new version of the resource, and this version will not be deleted from the database when the version-controlled resource is deleted by you.</li>
<li>Loading a version-controlled resource is similar to loading any other regular resource in Oracle XML DB using the path name.</li>
<li>Loading a version of the resource.<br>
To load a version of a resource, you must first find the resource object id of the version and then load the version using that id. The resource object id can be found from the resource version history or from the version-controlled resource itself.</li>
</ul><h3>Interface to RDBMSs</h3>

<h4>Sedna</h4>

<ul>
<li>SQL connection from XQuery.</li>
<li>Through ODBC interface

<ul>
<li>Allows querying and updating relational databases</li>
<li>Query results are presented as a sequence of XML elements:</li>
</ul>
</li>
</ul><div class="highlight">
<pre><span class="nt">&lt;tuple</span> <span class="na">column1=</span><span class="s">“value1”</span> <span class="err">…</span> <span class="na">columnN=</span><span class="s">“valueN”/</span><span class="nt">&gt;</span>
</pre>
</div>


<ul>
<li>APIs developed by Sedna team:

<ul>
<li>C</li>
<li>Java </li>
<li>Scheme </li>
<li>OmniMark (<em>Stilo’s streaming programming language used for content engineering tasks</em>)</li>
</ul>
</li>
<li>APIs contributed by Sedna open source users:

<ul>
<li>Python</li>
<li>PHP</li>
<li>.Net</li>
<li>XML:DB API  (<em>standard API for XML databases, supported by other products also</em>)</li>
</ul>
</li>
</ul><h4>Oracle XML DB</h4>

<ul>
<li>Oracle XML DB Resource APIs.<br>
These are used to access XMLType and other data. In other words, to access data in the Oracle XML DB hierarchically indexed repository. The APIs are available in the following languages:

<ul>
<li>SQL, through the RESOURCE_VIEW and PATH_VIEW APIs</li>
<li>PL/SQL, through DBMS_XDB and DBS_XMLSTORE APIs</li>
<li>Java through the Resource API for Java</li>
<li>C (OCI) through the C API for XML</li>
<li>Oracle Data Provider for .NET (ODP.NET)</li>
</ul>
</li>
<li>Oracle XML DB Protocol Server.<br>
Oracle XML DB supports FTP, HTTP, and WebDAV protocols, as well as JDBC, for fast access of XML data stored in Oracle Database in XMLType tables and columns. </li>
</ul><h2>References</h2>
<blockquote>
<p><a href="http://www.xquery.com/tips_and_tricks/xpath_and_namespaces.html">Why does my XQuery fail when I override the default namespace?</a></p>

<p><a href="http://en.wikibooks.org/wiki/XML_-_Managing_Data_Exchange/The_many-to-many_relationship">XML - Managing Data Exchange/The many-to-many relationship</a></p>
</blockquote>


</article>
  </div>

</div>


     <!-- cache end -->

      <div id="delete_link" class="instapaper_ignore"><a href="https://gist.github.com/delete/1929927" data-confirm="Are you sure?" data-method="delete">delete this gist</a></div>

  </div>

    <div id="comments">

<form action="https://gist.github.com/1929927/comment" method="post"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" type="hidden" value="sfsib+2mogDgc4KIjEu6jbnJtggUW13qTOO65gv+RdU="></div>          
<p class="comment-form-error" style="display:none">You must write something to leave a comment</p>
<div class="comment-form previewable-comment-form previewable-comment-form-attached" data-repository="">
  <p class="help">Comments are parsed with <a href="http://github.github.com/github-flavored-markdown/" class="gfm-help" target="_blank">GitHub Flavored Markdown</a></p>
  <ul class="edit-preview-tabs inline-tabs">
    <li><a href="https://gist.github.com/1929927#write_bucket_112" action="write" class="selected">Write</a></li>
    <li><a href="https://gist.github.com/1929927#preview_bucket_112" action="preview">Preview</a></li>
  </ul>
  <div id="write_bucket_112" class="tab-content" style="display: block; ">
    <textarea name="comment[body]" tabindex="1" id="comment_body_112" data-suggester-list="comment_body_112_mentions"></textarea>
  </div>
  <div id="preview_bucket_112" class="new-comments tab-content" style="display: none; ">
    
<div id="openstruct-179836200" class="comment normal-comment">
  <div class="cmeta">
    <p class="author">
        <span class="gravatar"><img height="20" src="./11500811g_files/71ad5da0dd03afb5ccd7a4f3f5ceec75" width="20"></span>
      <strong class="author"><a href="https://gist.github.com/edwardtoday">edwardtoday</a></strong>
      <em class="action-text">
        <a href="https://gist.github.com/1929927#openstruct-179836200">
        commented
        </a>
      </em>
    </p>
    <p class="info">
      <em class="date"><a href="https://gist.github.com/1929927#openstruct-179836200"><time class="js-relative-date" datetime="2012-02-29T06:30:56-08:00" title="2012-02-29 06:30:56">just now</time></a></em>
        <span class="icon"></span>
    </p>
  </div>


  <div class="body">
    <div class="formatted-content">
      <div class="content-body markdown-body "><p>Nothing to preview</p></div>
    </div>
  </div>
</div>

  </div>

  <div class="suggester-container js-navigation-container">
  <div class="suggester" id="comment_body_112_mentions">
    <ul>
    </ul>
  </div>
</div>

</div>

          <div class="form-actions">
            <button type="submit" class="classy" tabindex="2"><span>Add Gist Comment</span></button>
          </div>
</form>    </div>

</div><!-- /.main -->

    </div> <!-- site -->

    <div class="push"></div>

    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="logo">
            <a href="https://github.com/">
              <img alt="GitHub" src="./11500811g_files/logo_white.png">
            </a>
          </div>
          <div class="more">
            <div class="links">
              <a href="https://github.com/blog"><strong>Blog</strong></a> |
              <a href="https://github.com/about">About</a> |
              <a href="https://github.com/contact">Support</a> |
              <a href="https://github.com/contact">Contact</a> |
              <a href="https://github.com/site/privacy">Privacy</a> |
              <a href="https://github.com/site/terms">Terms of Service</a>
            </div>
            <div class="company">
              ©
              2011
              <span title="0.84868s from fe8.rs.github.com">GitHub</span> Inc.
              All rights reserved.
           </div>
          </div>
        </div>
        <div class="sponsor">
          <div>
            Powered by the <a href="http://www.rackspace.com/">Dedicated
            Servers</a> and<br> <a href="http://www.rackspacecloud.com/">Cloud
            Computing</a> of Rackspace Hosting<span>®</span>
          </div>
          <a href="http://www.rackspace.com/">
            <img alt="Dedicated Server" src="./11500811g_files/rackspaces_logo.png">
          </a>
        </div>
      </div>
    </div>
  

    <div id="facebox" style="display:none;">       <div class="popup">         <div class="content">         </div>         <a href="https://gist.github.com/1929927#" class="close"><img src="./11500811g_files/closelabel.png" class="close_image" title="close"></a>       </div>     </div></body></html>